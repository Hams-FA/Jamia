<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>إدارة الأقسام</title>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="style.css">
      <link rel="shortcut icon" href="logo3.jpg">

      <style>
            body {
                  background-color: #c7d4c0;
            }

            #logo {
                  float: right;
                  margin: 0;
                  width: 5%;
                  height: 5%;
            }

            #navlist {
                  float: left;
            }
      </style>
</head>

<body style="text-align: center;">


      <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <img id="logo" src="logo3.jpg">
            <div class="container">
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul id="navlist" class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a href="" class="nav-link" id="logout" style="color: red; font-size: 14px;">تسجيل الخروج </a>
                        </li>
                        <li class="nav-item">
                            <a href="Untitled-1.html"  style=" font-size: 14px; text-decoration: underline; color: black;" class="nav-link"> إدارة الأقسام</a>
                        </li>
                        
                        <li class="nav-item">
                            <a href="transaction.html"  style=" font-size: 14px; ";
                            class="nav-link"> المتأخرين عن الدفع</a>
                        </li>
                        <li class="nav-item">
                            <a href="activation.html" style=" font-size: 14px; " class="nav-link">إدارة المستخدمين</a>
                        </li>
                        <li class="nav-item">
                            <a href="userProfiles.html" style=" font-size:14px;" class="nav-link">المستخدمين</a>
                        </li>
                        <li style = "float: right; "class="nav-item">
                              <a href="stripe.html" class="nav-link">الدفع</a>
                        </li>
                        <li class="nav-item">
                            <a href="jamias.html" style=" font-size: 14px;" class="nav-link">التحويل الشهري</a>
                        </li>
                        <li class="nav-item">
                            <a href="JamiaDetails.html" style=" font-size: 14px;" class="nav-link">الجمعيات </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

      <div style="text-align: center; " class="container-xl d-flex justify-content-center align-items-center p-5">
            <div style="text-align: center; " class="table-wrapper">
                  <div style="text-align: center; " class="table-title">
                        <div style="text-align: center; " class="row">
                              <h2 style="text-align: center;">إدارة الأقسام
                              </h2>


                        </div>
                  </div>
                  <div class="modal" id="emptyCategoryNameModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog" role="document">
                              <div class="modal-content">
                                    <div class="modal-header">
                                          <h5 class="modal-title">تحذير</h5>
                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                          </button>
                                    </div>
                                    <div class="modal-body">
                                          <p>لا يمكن ان يكون اسم القسم فارغ</p>
                                    </div>
                                    <div class="modal-footer">
                                          <button type="button" class="btn btn-danger"
                                                data-dismiss="modal">إغلاق</button>
                                    </div>
                              </div>
                        </div>
                  </div>
                  <!-- CREATE LIST FOR CATEGORY FILL BY FIRESTORE-->
                  <div class="list-group p-3">


                  </div>
                  <!-- END OF LIST -->
                  <!-- add button-->
                  <form class="p-3">
                        <div class="form-group ">

                              <input type="text" class="form-control form-control-lg" placeholder="اسم القسم"
                                    id="categoryName" required>
                        </div>
                  </form>
                  <div class="row">
                        <div class="col-sm-12">
                              <a id="addCategoryButton" class="btn btn-success" data-toggle="modal"><i
                                          class="material-icons">&#xE147;</i> <span>اضافة جديد</span></a>
                        </div>
                  </div>
                  <!-- ADD FORM TO ADD CATEGORY-->


            </div>
      </div>
      </div>
      <iframe name="result" allow="midi; geolocation; microphone; camera; display-capture; encrypted-media;"
            allowfullscreen="" allowpaymentrequest="" frameborder="0" src=""
            sandbox="allow-modals allow-forms allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation allow-downloads"></iframe>


      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
      <script type="module">

            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-analytics.js";
            import { getFirestore, collection, getDocs, getDoc, addDoc } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-firestore.js";
            import { doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-firestore.js";
            import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-auth.js";
            // import { useCollection } from 'react-firebase-hooks/firestore.js';





            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                  apiKey: "AIzaSyAPD2rLWY3Nvbs3cW19-SkCQ7NtfeIr_xk",
                  authDomain: "jamia-2bcc1.firebaseapp.com",
                  projectId: "jamia-2bcc1",
                  storageBucket: "jamia-2bcc1.appspot.com",
                  messagingSenderId: "585806474023",
                  appId: "1:585806474023:web:e98bb5c8e5e1472f4c1702",
                  measurementId: "G-45VRZZ51WF"
            };

            // doc1.data().startDate.toDate() >= new Date() 
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            document.getElementById("logout").addEventListener('click', function () {
                  signOut(auth).then(() => {
                        // Sign-out successful.
                        if (confirm("لقد تم تسجيل خروجك بنجاح!")) {
                              location.replace("login.html");
                        }


                  }).catch((error) => {
                        console.log('Error singing in, ', error.message);
                        alert("حدث خطأ!! حاول مرة اخرى");
                  });

            });
            const analytics = getAnalytics(app);
            // Initialize Cloud Firestore and get a reference to the service
            const db = getFirestore(app);

            //  get catogeries and add it to list-group
            const catogeriesRef = collection(db, "categories")
            const catogeriesSnapshot = getDocs(catogeriesRef);
            const catogeriesList = document.querySelector(".list-group");
            (async () => {
                  const catogeriesSnapshot = await getDocs(catogeriesRef);
                  catogeriesSnapshot.forEach((docx) => {
                        console.log(docx.id, " => ", docx.data());
                        const catogery = document.createElement('a');
                        // catogery.href = "#";
                        catogery.classList.add("list-group-item");
                        catogery.classList.add("list-group-item-action");
                        catogery.textContent = docx.data().name;
                        // add delete icon
                        const deleteIcon = document.createElement('i');
                        deleteIcon.classList.add("material-icons");
                        deleteIcon.classList.add("delete");
                        deleteIcon.textContent = "delete";

                        catogery.appendChild(deleteIcon);
                        // add action if delete icon clicked
                        deleteIcon.addEventListener('click', function () {
                              console.log("delete clicked");
                              console.log(docx.id);
                              // delete from firestore
                              const docRef = doc(db, "categories", docx.id);
                              deleteDoc(docRef).then(() => {
                                    console.log("Document successfully deleted!");
                                    location.reload();
                                    alert("تمت عملية حذف قسم بنجاح");
                              }).catch((error) => {
                                    // The document probably doesn't exist.
                                    console.error("Error removing document: ", error);
                              });
                        });
                        catogeriesList.appendChild(catogery);

                  });
            })();
            // when clicking on add category button open modal
            $('#addCategory').click(function () {
                  $('#addCategoryModal').modal('show');
            });
            // get button by id
            const addCategoryButton = document.getElementById('addCategoryButton');
            // add event listener to button
            addCategoryButton.addEventListener('click', async (e) => {
                  // show confirm dialog
                  //const confirm = window.confirm("هل انت متأكد من اضافة هذا القسم؟");
                  // if (confirm) {
                  //       // get category name
                  //       const categoryName = document.getElementById('categoryName').value;
                  //       // add category to firestore
                  //       const docRef = await addDoc(collection(db, "categories"), {
                  //             name: categoryName,
                  //             isDeleted: false
                  //       });
                  //       console.log("Document written with ID: ", docRef.id);
                  //       // reload page
                  //       location.reload();
                  // }
                  // get category name
                  const categoryName = document.getElementById('categoryName').value;
                  // check if category name is empty
                  if (categoryName == "") {
                        // sho modal
                        $('#emptyCategoryNameModal').modal('show');
                  } else {
                        // add category to firestore
                        const docRef = await addDoc(collection(db, "categories"), {
                              name: categoryName,
                              isDeleted: false
                        });
                        console.log("Document written with ID: ", docRef.id);

                        // reload page
                        location.reload();
                        alert("لقد تمت عملية إضافة قسم بنجاح");
                  }
                  // const categoryCollection = collection(db, 'categories');
                  // // add category to firestore
                  // await addDoc(categoryCollection, {
                  //       name: categoryName,
                  //       //  uid: uid
                  // });
                  // close modal
                  $('#addCategoryModal').modal('hide');
                  // clear input
                  document.getElementById('categoryName').value = '';
                  // show success message
                  //  location.reload(); 
            });
            // add category to firestore
            // document.getElementById("addCategoryModal").addEventListener('click', function () {
            //       const categoryName = document.getElementById("categoryName").value;
            //       const categoryRef = doc(db, "categories", categoryName);
            //       updateDoc(categoryRef, {
            //             name: categoryName
            //       }).then(() => {
            //             console.log("Document successfully written!");
            //             alert("تمت الاضافة بنجاح");
            //             location.reload();
            //       }).catch((error) => {
            //             console.error("Error writing document: ", error);
            //             alert("حدث خطأ!! حاول مرة اخرى");
            //       });
            // });
      </script>
</body>

</html>